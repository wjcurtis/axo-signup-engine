<!-- ===== AXO ADMIN DASHBOARD + LIVE PRICE BAR (DROP-IN) ===== -->

<style>

/* Modal + overlay */

#axo-admin-overlay{position:fixed;inset:0;background:#0009;display:none;z-index:9998}

#axo-admin{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);

  width:min(1000px,92vw);max-height:86vh;overflow:auto;background:#111827;color:#e5e7eb;

  border:1px solid #1f2937;border-radius:14px;box-shadow:0 20px 60px #000c;display:none;z-index:9999}

.axo-head{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid #1f2937}

.axo-title{font-size:18px;font-weight:600}

.axo-x{cursor:pointer;border:1px solid #2a3a6a;background:#101936;border-radius:10px;padding:8px 12px}

.axo-body{padding:18px}

.axo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}

.axo-row{margin:10px 0}

.axo-label{display:block;font-size:12px;color:#9ca3af;margin:0 0 6px}

.axo-input,.axo-select,.axo-text{width:100%;padding:10px 12px;border:1px solid #374151;border-radius:10px;background:#0b1220;color:#e5e7eb;outline:none}

.axo-text{min-height:80px;resize:vertical}

.axo-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:18px}

.axo-btn{padding:10px 14px;border-radius:10px;border:1px solid #2a3a6a;background:#101936;color:#cbd5e1;cursor:pointer}

.axo-btn.primary{background:linear-gradient(180deg,#3b82f6,#2563eb);border-color:#2b50a8;color:#fff}

.axo-hint{color:#94a3b8;font-size:13px;margin-top:6px}

.axo-ok{color:#10b981}.axo-err{color:#ef4444}

.axo-sec{margin:18px 0 8px;font-weight:600;color:#cbd5e1}

.axo-small{font-size:12px;color:#9ca3af}

.axo-kv{display:grid;grid-template-columns:200px 1fr;gap:10px;align-items:center}

/* Launcher (small rocket) */

#adm-rocket{position:fixed;top:12px;right:14px;z-index:9980;cursor:pointer;border:0;background:none}

#adm-rocket svg{width:22px;height:22px;filter:drop-shadow(0 1px 2px #0007)}

/* bottom sticky live bar */

.live-bar{position:fixed;bottom:0;left:0;width:100%;background:#0b1220;color:#e5e7eb;border-top:1px solid #2a334d;

  font-size:14px;padding:8px 12px;display:flex;justify-content:center;align-items:center;gap:20px;z-index:9990}

@media (max-width:640px){.axo-grid{grid-template-columns:1fr}}

</style>



<!-- Admin launcher (tiny rocket) -->

<button id="adm-rocket" title="Admin">

  <svg viewBox="0 0 24 24" fill="#e5e7eb" xmlns="http://www.w3.org/2000/svg">

    <path d="M14 3l7 7-4 1-3 3-1 4-7-7 4-1 3-3 1-4zM5 19l3-3-1 4-2 1 0-2z"/>

  </svg>

</button>



<!-- Modal & overlay -->

<div id="axo-admin-overlay" aria-hidden="true"></div>

<div id="axo-admin" role="dialog" aria-modal="true" aria-labelledby="axo-admin-title">

  <div class="axo-head">

    <div id="axo-admin-title" class="axo-title">AXO Admin</div>

    <button id="adm-x" class="axo-x">Close</button>

  </div>



  <!-- PIN view -->

  <div id="adm-pin" class="axo-body" style="display:none">

    <div class="axo-sec" style="margin-top:0">Enter Admin PIN</div>

    <div class="axo-row">

      <label class="axo-label" for="adm-pin-input">PIN</label>

      <input id="adm-pin-input" type="password" class="axo-input" placeholder="••••••"/>

    </div>

    <div class="axo-actions">

      <button id="adm-login" class="axo-btn primary">Unlock</button>

      <button id="adm-back" class="axo-btn">Back</button>

    </div>

    <div id="adm-pin-msg" class="axo-hint"></div>

  </div>



  <!-- ADMIN PANEL -->

  <div id="adm-panel" class="axo-body" style="display:none">

    <!-- Live Market -->

    <div class="axo-sec">Live Market</div>

    <div class="axo-grid">

      <div><div class="axo-label">XRP Price (USD)</div><div id="adm-xrp" class="axo-small">$—</div></div>

      <div><div class="axo-label">AXO Price (USD, static)</div><div id="adm-axo" class="axo-small">$0.01</div></div>

      <div><div class="axo-label">1 XRP =</div><div id="adm-ratio" class="axo-small">— AXO</div></div>

    </div>

    <div class="axo-small" style="margin-top:6px">Source: <span id="adm-src">—</span> · Updated <span id="adm-ts">—</span></div>



    <!-- Incentives -->

    <div class="axo-sec">Incentives</div>

    <div class="axo-grid">

      <div><label class="axo-label">Signup Bonus (AXO)</label><input id="signup_bonus" class="axo-input" type="number" min="0" step="1"></div>

      <div><label class="axo-label">Referral Reward (AXO)</label><input id="referral_reward" class="axo-input" type="number" min="0" step="1"></div>

      <div>

        <label class="axo-label">Require TrustLine</label>

        <select id="require_trustline" class="axo-select"><option>true</option><option>false</option></select>

      </div>

    </div>



    <!-- Pricing & Flow -->

    <div class="axo-sec">Pricing & Flow</div>

    <div class="axo-grid">

      <div><label class="axo-label">AXO Price (USD, static)</label><input id="axo_price_usd" class="axo-input" type="number" min="0" step="0.0001"></div>

      <div><label class="axo-label">Buy Flow Enabled</label><select id="buy_enabled" class="axo-select"><option>true</option><option>false</option></select></div>

      <div><label class="axo-label">Quick Signup Enabled</label><select id="quick_signup_enabled" class="axo-select"><option>false</option><option>true</option></select></div>

    </div>



    <!-- Fees & Vault -->

    <div class="axo-sec">Fees & Vault</div>

    <div class="axo-grid">

      <div><label class="axo-label">Flat Fee (XRP) per claim</label><input id="fee_xrp" class="axo-input" type="number" min="0" step="0.000001"></div>

      <div class="axo-kv"><div class="axo-label">Vault Address (r‑...)</div><input id="vault_addr" class="axo-input" placeholder="r........"/></div>

      <div></div>

    </div>



    <!-- Abuse & Limits -->

    <div class="axo-sec">Abuse & Limits</div>

    <div class="axo-grid">

      <div><label class="axo-label">Daily Cap (AXO)</label><input id="daily_cap_axo" class="axo-input" type="number" min="0" step="1"></div>

      <div><label class="axo-label">Max Claims / Wallet</label><input id="max_claims_per_wallet" class="axo-input" type="number" min="1" step="1"></div>

      <div><label class="axo-label">Claims / Hour (rate‑limit)</label><input id="rate_limit_claims_per_hour" class="axo-input" type="number" min="1" step="1"></div>

    </div>

    <div class="axo-grid" style="margin-top:10px">

      <div class="axo-row">

        <label class="axo-label">Whitelist (comma r‑...)</label>

        <textarea id="whitelist_addresses" class="axo-text" placeholder="r...., r...."></textarea>

      </div>

      <div class="axo-row">

        <label class="axo-label">Blacklist (comma r‑...)</label>

        <textarea id="blacklist_addresses" class="axo-text" placeholder="r...., r...."></textarea>

      </div>

      <div>

        <label class="axo-label">Airdrop Paused</label>

        <select id="airdrop_paused" class="axo-select"><option>false</option><option>true</option></select>

        <div class="axo-row"></div>

        <label class="axo-label">Maintenance Mode</label>

        <select id="maintenance_mode" class="axo-select"><option>false</option><option>true</option></select>

      </div>

    </div>



    <div class="axo-actions">

      <button id="adm-close" class="axo-btn">Close</button>

      <button id="adm-save" class="axo-btn primary">Save</button>

    </div>

    <div id="adm-msg" class="axo-hint"></div>

  </div>

</div>



<!-- bottom sticky live market bar -->

<div class="live-bar" id="live-bar">

  <span>AXO: <span id="live-axo">$0.01</span> USD</span>

  <span>XRP: <span id="live-xrp">$0.0000</span> USD</span>

  <span>1 XRP = <span id="live-ratio">—</span> AXO</span>

  <span class="axo-small" id="live-meta"></span>

</div>



<script>

(function(){

  const el = id => document.getElementById(id);



  // ===== Launcher & modal open/close =====

  const overlay = el('axo-admin-overlay');

  const modal   = el('axo-admin');

  const pinView = el('adm-pin');

  const panel   = el('adm-panel');



  function openModal(){ overlay.style.display='block'; modal.style.display='block'; showGate(); }

  function closeModal(){ overlay.style.display='none'; modal.style.display='none'; }



  el('adm-rocket').addEventListener('click', openModal);

  el('adm-x').addEventListener('click', onClose);

  el('adm-close').addEventListener('click', onClose);

  el('adm-back').addEventListener('click', closeModal);



  async function onClose(){

    // enforce fresh PIN next time

    try{ await fetch('/api/admin/logout',{method:'POST'}); }catch(_){}

    closeModal();

  }



  // ===== Auth gate =====

  async function isAuthed(){

    try{ const r = await fetch('/api/admin/config'); return r.status===200; }

    catch(_){ return false; }

  }

  async function showGate(){

    if (await isAuthed()){ await loadConfig(); pinView.style.display='none'; panel.style.display='block'; }

    else { pinView.style.display='block'; panel.style.display='none'; }

  }



  el('adm-login').addEventListener('click', async () => {

    const pin = el('adm-pin-input').value.trim();

    const msg = el('adm-pin-msg');

    try{

      const r = await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pin})});

      if(r.ok){ msg.textContent='Unlocked.'; msg.className='axo-hint axo-ok'; await showGate(); }

      else    { msg.textContent='Invalid PIN.'; msg.className='axo-hint axo-err'; }

    }catch(e){ msg.textContent='Network error.'; msg.className='axo-hint axo-err'; }

  });



  // ===== Load & Save config =====

  async function loadConfig(){

    try{

      const r = await fetch('/api/admin/config'); if(!r.ok) return;

      const s = (await r.json()).data || {};

      const map = [

        'signup_bonus','referral_reward','require_trustline',

        'axo_price_usd','buy_enabled','quick_signup_enabled',

        'fee_xrp','vault_addr',

        'daily_cap_axo','max_claims_per_wallet','rate_limit_claims_per_hour',

        'whitelist_addresses','blacklist_addresses','airdrop_paused','maintenance_mode'

      ];

      for(const k of map){

        const node = el(k); if(!node) continue;

        if(node.tagName==='SELECT') node.value = String(s[k]);

        else if(node.tagName==='TEXTAREA') node.value = (s[k]||[]).join(', ');

        else node.value = (s[k] ?? '');

      }

      // reflect AXO price in headers

      el('adm-axo').textContent = '$' + Number(s.axo_price_usd || 0.01).toFixed(4);

    }catch(_){}

  }



  el('adm-save').addEventListener('click', async ()=>{

    const v = id => el(id).value;

    const body = {

      signup_bonus: Number(v('signup_bonus')||0),

      referral_reward: Number(v('referral_reward')||0),

      require_trustline: (v('require_trustline')==='true'),

      axo_price_usd: Number(v('axo_price_usd')||0.01),

      buy_enabled: (v('buy_enabled')==='true'),

      quick_signup_enabled: (v('quick_signup_enabled')==='true'),

      fee_xrp: Number(v('fee_xrp')||0),

      vault_addr: v('vault_addr').trim(),

      daily_cap_axo: Number(v('daily_cap_axo')||0),

      max_claims_per_wallet: Number(v('max_claims_per_wallet')||1),

      rate_limit_claims_per_hour: Number(v('rate_limit_claims_per_hour')||1),

      whitelist_addresses: v('whitelist_addresses'),

      blacklist_addresses: v('blacklist_addresses'),

      airdrop_paused: (v('airdrop_paused')==='true'),

      maintenance_mode: (v('maintenance_mode')==='true'),

    };

    const msg = el('adm-msg');

    try{

      const r = await fetch('/api/admin/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});

      if(r.ok){ msg.textContent='Saved. Logging out…'; msg.className='axo-hint axo-ok'; await fetch('/api/admin/logout',{method:'POST'}); closeModal(); }

      else   { msg.textContent='Save failed.'; msg.className='axo-hint axo-err'; }

    }catch(e){ msg.textContent='Network error.'; msg.className='axo-hint axo-err'; }

  });



  // ===== Live price bar (auto-refresh) =====

  async function refreshMarket(){

    try{

      const r = await fetch('/api/market',{cache:'no-store'});

      if(!r.ok) return;

      const m = await r.json(); // { xrp_usd, axo_usd, source, ts }

      const xrp = Number(m.xrp_usd||0);

      const axo = Number(m.axo_usd||0.01);

      const ratio = (xrp>0 && axo>0) ? (xrp/axo) : 0;



      el('live-xrp').textContent = '$' + xrp.toFixed(4);

      el('live-axo').textContent = '$' + axo.toFixed(4);

      el('live-ratio').textContent = ratio ? Math.round(ratio).toString() : '—';

      el('live-meta').textContent = (m.source||'') + (m.ts ? ' • ' + new Date(m.ts*1000).toLocaleTimeString() : '');



      // mirror in admin header block if open

      const hx = el('adm-xrp'); if(hx) hx.textContent = '$' + xrp.toFixed(4);

      const hr = el('adm-ratio'); if(hr) hr.textContent = ratio ? Math.round(ratio).toString() + ' AXO' : '— AXO';

      const hs = el('adm-src'); if(hs) hs.textContent = m.source||'';

      const ht = el('adm-ts'); if(ht) ht.textContent = m.ts ? new Date(m.ts*1000).toLocaleTimeString() : '';

    }catch(_){}

    setTimeout(refreshMarket, 60000); // every 60s

  }

  refreshMarket();

})();

</script>

<!-- ===== /AXO ADMIN DASHBOARD + LIVE PRICE BAR ===== -->
