<!-- ===== AXO ADMIN DASHBOARD + LIVE PRICE BAR (DROP-IN) ===== -->

<style>

/* Modal shell */

#axo-admin-overlay{position:fixed;inset:0;background:#0009;display:none;z-index:9998}

#axo-admin{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);

  width:min(1000px,92vw);max-height:86vh;overflow:auto;background:#111827;color:#e5e7eb;

  border:1px solid #1f2937;border-radius:14px;box-shadow:0 20px 60px #000c;display:none;z-index:9999}

.axo-head{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid #1f2937}

.axo-title{font-size:18px;font-weight:600}

.axo-x{cursor:pointer;border:1px solid #2a3a6a;background:#101936;border-radius:10px;padding:8px 12px}

.axo-body{padding:18px}

.axo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}

.axo-row{margin:10px 0}

.axo-label{display:block;font-size:12px;color:#9ca3af;margin:0 0 6px}

.axo-input,.axo-select,.axo-text{width:100%;padding:10px 12px;border:1px solid #374151;border-radius:10px;background:#0b1220;color:#e5e7eb;outline:none}

.axo-text{min-height:80px;resize:vertical}

.axo-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:18px}

.axo-btn{padding:10px 14px;border-radius:10px;border:1px solid #2a3a6a;background:#101936;color:#cbd5e1;cursor:pointer}

.axo-btn.primary{background:linear-gradient(180deg,#3b82f6,#2563eb);border-color:#2b50a8;color:#fff}

.axo-hint{color:#94a3b8;font-size:13px;margin-top:6px}

.axo-ok{color:#10b981}.axo-err{color:#ef4444}

.axo-sec{margin:18px 0 8px;font-weight:600;color:#cbd5e1}

.axo-small{font-size:12px;color:#9ca3af}

.axo-kv{display:grid;grid-template-columns:200px 1fr;gap:10px;align-items:center}

/* bottom sticky live bar */

.live-bar{position:fixed;bottom:0;left:0;width:100%;background:#0b1220;color:#e5e7eb;border-top:1px solid #2a334d;

  font-size:14px;padding:8px 12px;display:flex;justify-content:center;align-items:center;gap:20px;z-index:9990}

</style>



<div id="axo-admin-overlay" aria-hidden="true"></div>

<div id="axo-admin" role="dialog" aria-modal="true" aria-labelledby="axo-admin-title">

  <div class="axo-head">

    <div id="axo-admin-title" class="axo-title">AXO Admin</div>

    <button id="adm-x" class="axo-x">Close</button>

  </div>



  <!-- PIN view (always required on open) -->

  <div id="adm-pin" class="axo-body" style="display:none">

    <div class="axo-sec" style="margin-top:0">Enter Admin PIN</div>

    <div class="axo-row">

      <label class="axo-label" for="adm-pin-input">PIN</label>

      <input id="adm-pin-input" type="password" class="axo-input" placeholder="••••••"/>

    </div>

    <div class="axo-actions">

      <button id="adm-login" class="axo-btn primary">Unlock</button>

      <button id="adm-back" class="axo-btn">Back</button>

    </div>

    <div id="adm-pin-msg" class="axo-hint"></div>

  </div>



  <!-- ADMIN PANEL -->

  <div id="adm-panel" class="axo-body" style="display:none">

    <!-- Live Market (auto-refresh) -->

    <div class="axo-sec">Live Market</div>

    <div class="axo-grid">

      <div><div class="axo-label">XRP Price (USD)</div><div id="adm-xrp" class="axo-small">$—</div></div>

      <div><div class="axo-label">AXO Price (USD, static)</div><div id="adm-axo" class="axo-small">$0.01</div></div>

      <div><div class="axo-label">1 XRP =</div><div id="adm-ratio" class="axo-small">— AXO</div></div>

    </div>

    <div class="axo-small" style="margin-top:6px">Source: <span id="adm-src">—</span> · Updated <span id="adm-ts">—</span></div>



    <!-- Incentives -->

    <div class="axo-sec">Incentives</div>

    <div class="axo-grid">

      <div><label class="axo-label">Signup Bonus (AXO)</label><input id="signup_bonus" class="axo-input" type="number" min="0" step="1"></div>

      <div><label class="axo-label">Referral Reward (AXO)</label><input id="referral_reward" class="axo-input" type="number" min="0" step="1"></div>

      <div>

        <label class="axo-label">Require TrustLine</label>

        <select id="require_trustline" class="axo-select"><option>true</option><option>false</option></select>

      </div>

    </div>



    <!-- Pricing & Flow -->

    <div class="axo-sec">Pricing & Flow</div>

    <div class="axo-grid">

      <div><label class="axo-label">AXO Price (USD, static)</label><input id="axo_price_usd" class="axo-input" type="number" min="0" step="0.0001"></div>

      <div><label class="axo-label">Buy Flow Enabled</label><select id="buy_enabled" class="axo-select"><option>true</option><option>false</option></select></div>

      <div><label class="axo-label">Quick Signup Enabled</label><select id="quick_signup_enabled" class="axo-select"><option>false</option><option>true</option></select></div>

    </div>



    <!-- Fees & Vault -->

    <div class="axo-sec">Fees & Vault</div>

    <div class="axo-grid">

      <div><label class="axo-label">Flat Fee (XRP) per claim</label><input id="fee_xrp" class="axo-input" type="number" min="0" step="0.000001"></div>

      <div class="axo-kv"><div class="axo-label">Vault Address (r‑...)</div><input id="vault_addr" class="axo-input" placeholder="r........"/></div>

      <div></div>

    </div>



    <!-- Abuse & Limits -->

    <div class="axo-sec">Abuse & Limits</div>

    <div class="axo-grid">

      <div><label class="axo-label">Daily Cap (AXO)</label><input id="daily_cap_axo" class="axo-input" type="number" min="0" step="1"></div>

      <div><label class="axo-label">Max Claims / Wallet</label><input id="max_claims_per_wallet" class="axo-input" type="number" min="1" step="1"></div>

      <div><label class="axo-label">Claims / Hour (rate‑limit)</label><input id="rate_limit_claims_per_hour" class="axo-input" type="number" min="1" step="1"></div>

    </div>

    <div class="axo-grid" style="margin-top:10px">

      <div class="axo-row">

        <label class="axo-label">Whitelist (comma r‑...)</label>

        <textarea id="whitelist_addresses" class="axo-text" placeholder="r...., r...."></textarea>

      </div>

      <div class="axo-row">

        <label class="axo-label">Blacklist (comma r‑...)</label>

        <textarea id="blacklist_addresses" class="axo-text" placeholder="r...., r...."></textarea>

      </div>

      <div>

        <label class="axo-label">Airdrop Paused</label>

        <select id="airdrop_paused" class="axo-select"><option>false</option><option>true</option></select>

        <div class="axo-row"></div>

        <label class="axo-label">Maintenance Mode</label>

        <select id="maintenance_mode" class="axo-select"><option>false</option><option>true</option></select>

      </div>

    </div>



    <!-- Manual Send AXO (from Vault) -->

    <div class="axo-sec">Manual Send AXO</div>

    <div class="axo-grid">

      <div class="axo-kv"><div class="axo-label">Destination (r‑address)</div><input id="manual_dest" class="axo-input" placeholder="r........"/></div>

      <div><label class="axo-label">Amount (AXO)</label><input id="manual_amount" class="axo-input" type="number" min="1" step="1"/></div>

      <div class="axo-row" style="display:flex;align-items:flex-end">

        <button id="manual_send_btn" class="axo-btn">Send AXO</button>

      </div>

    </div>

    <div id="adm-msg" class="axo-hint"></div>



    <div class="axo-actions">

      <button id="adm-close" class="axo-btn">Close</button>

      <button id="adm-save" class="axo-btn primary">Save</button>

    </div>

  </div>

</div>



<!-- Sticky bottom live price bar -->

<div class="live-bar">

  <div>AXO: <span id="liveAxoPrice">—</span> USD</div>

  <div>XRP: <span id="liveXrpPrice">—</span> USD</div>

  <div>1 XRP = <span id="liveRatio">—</span> AXO</div>

</div>



<script>

(()=>{



  // ====== helpers ======

  const $ = (id) => document.getElementById(id);

  const qs = (sel) => document.querySelector(sel);

  const show = (el) => el.style.display='block';

  const hide = (el) => el.style.display='none';



  // ====== bind rocket (href="/admin") to open modal ======

  document.querySelectorAll('a[href="/admin"]').forEach(a=>{

    a.addEventListener('click',(e)=>{ e.preventDefault(); openAdmin(); });

  });



  // ====== elements ======

  const overlay=$('axo-admin-overlay'), modal=$('axo-admin'), pinView=$('adm-pin'), panel=$('adm-panel');

  $('adm-x').onclick = closeAndLogout;

  $('adm-close').onclick = closeAndLogout;

  $('adm-save').onclick = async ()=>{ await save(true); await logout(); closeModal(); };



  $('adm-login').onclick = login;

  $('adm-back').onclick  = closeModal;



  // manual send

  $('manual_send_btn').onclick = manualSend;



  // ====== modal controls ======

  function openAdmin(){

    show(overlay); show(modal);

    // always ask PIN on open

    hide(panel); show(pinView);

    $('adm-pin-input').value=''; $('adm-pin-msg').textContent='';

    $('adm-pin-input').focus();

    // kick market refresh (for header panel numbers)

    refreshMarket();

  }

  async function closeAndLogout(){ await logout(); closeModal(); }

  function closeModal(){ hide(overlay); hide(modal); hide(pinView); hide(panel); }



  // ====== auth ======

  async function isAuthed(){ try{ const r=await fetch('/api/admin/config',{cache:'no-store'}); return r.status===200; }catch{ return false; } }

  async function login(){

    const pin=$('adm-pin-input').value.trim();

    const m=$('adm-pin-msg'); m.textContent='';

    try{

      const r=await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pin})});

      if(r.ok){ await loadConfig(); hide(pinView); show(panel); }

      else { m.textContent='Invalid PIN.'; m.className='axo-hint axo-err'; }

    }catch{ m.textContent='Network error'; m.className='axo-hint axo-err'; }

  }

  async function logout(){ try{ await fetch('/api/admin/logout',{method:'POST'}); }catch{} }



  // ====== config load/save ======

  async function loadConfig(){

    try{

      const r=await fetch('/api/admin/config',{cache:'no-store'});

      if(!r.ok) return;

      const s=(await r.json()).data||{};

      for (const k of [

        'signup_bonus','referral_reward','require_trustline',

        'axo_price_usd','buy_enabled','quick_signup_enabled',

        'fee_xrp','vault_addr',

        'daily_cap_axo','max_claims_per_wallet','rate_limit_claims_per_hour',

        'whitelist_addresses','blacklist_addresses',

        'airdrop_paused','maintenance_mode'

      ]) {

        const el=$(k); if(!el) continue;

        if (el.tagName==='SELECT') el.value=String(s[k]);

        else if (el.tagName==='TEXTAREA') el.value=(s[k]||[]).join(', ');

        else el.value = (s[k] ?? '');

      }

      $('adm-msg').textContent='';

    }catch{}

  }



  async function save(silent=false){

    const v=id=>$(id).value;

    const body={

      signup_bonus:Number(v('signup_bonus')||0),

      referral_reward:Number(v('referral_reward')||0),

      require_trustline:(v('require_trustline')==='true'),

      axo_price_usd:Number(v('axo_price_usd')||0.01),

      buy_enabled:(v('buy_enabled')==='true'),

      quick_signup_enabled:(v('quick_signup_enabled')==='true'),

      fee_xrp:Number(v('fee_xrp')||0),

      vault_addr:v('vault_addr').trim(),

      daily_cap_axo:Number(v('daily_cap_axo')||0),

      max_claims_per_wallet:Number(v('max_claims_per_wallet')||1),

      rate_limit_claims_per_hour:Number(v('rate_limit_claims_per_hour')||1),

      whitelist_addresses:v('whitelist_addresses'),

      blacklist_addresses:v('blacklist_addresses'),

      airdrop_paused:(v('airdrop_paused')==='true'),

      maintenance_mode:(v('maintenance_mode')==='true'),

    };

    const r=await fetch('/api/admin/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});

    if(silent) return r.ok;

    const ok=r.ok; const el=$('adm-msg'); el.textContent = ok?'Saved.':'Save failed'; el.className='axo-hint '+(ok?'axo-ok':'axo-err');

    return ok;

  }



  // ====== Manual Send AXO (server must implement; here we POST to /api/admin/send) ======

  async function manualSend(){

    const dest=$('manual_dest').value.trim();

    const amt =Number($('manual_amount').value||0);

    const msg=$('adm-msg');

    if(!dest||!amt){ msg.textContent='Enter destination and amount.'; msg.className='axo-hint axo-err'; return; }

    try{

      const r=await fetch('/api/admin/send',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({dest, amount_axo:amt})});

      const j=await r.json().catch(()=>({}));

      if(r.ok){ msg.textContent=`Sent ${amt} AXO to ${dest}`; msg.className='axo-hint axo-ok'; $('manual_amount').value=''; }

      else{ msg.textContent=j.error||'Send failed'; msg.className='axo-hint axo-err'; }

    }catch{ msg.textContent='Network error'; msg.className='axo-hint axo-err'; }

  }



  // ====== Market refresh (used by admin + bottom bar) ======

  async function refreshMarket(){

    try{

      const r=await fetch('/api/market',{cache:'no-store'});

      if(!r.ok) return;

      const j=await r.json();

      // admin panel widgets

      if($('adm-xrp'))   $('adm-xrp').textContent   = j.xrp_usd ? `$${j.xrp_usd}` : '—';

      if($('adm-axo'))   $('adm-axo').textContent   = j.axo_usd ? `$${j.axo_usd}` : '—';

      if($('adm-ratio')) $('adm-ratio').textContent = j.axo_per_xrp ? `${Math.floor(j.axo_per_xrp)} AXO` : '—';

      if($('adm-src'))   $('adm-src').textContent   = j.source || '';

      if($('adm-ts'))    $('adm-ts').textContent    = new Date((j.ts||0)*1000).toLocaleTimeString();

      // bottom sticky bar

      if($('liveAxoPrice')) $('liveAxoPrice').textContent = j.axo_usd ? `$${j.axo_usd}` : '—';

      if($('liveXrpPrice')) $('liveXrpPrice').textContent = j.xrp_usd ? `$${j.xrp_usd}` : '—';

      if($('liveRatio'))    $('liveRatio').textContent    = j.axo_per_xrp ? Math.floor(j.axo_per_xrp) : '—';

    }catch{}

  }

  // kick off market refresh forever

  refreshMarket(); setInterval(refreshMarket, 30_000);



})();</script>

<!-- ===== END AXO ADMIN DASHBOARD + LIVE PRICE BAR ===== -->
