<!doctype html>

<html lang="en">

<head>

<meta charset="utf-8"/>

<meta name="viewport" content="width=device-width,initial-scale=1"/>

<title>AXO Utility Hub</title>

<style>

:root{--bg:#0f172a;--panel:#111827;--text:#e5e7eb;--muted:#94a3b8;--accent:#2563eb;--ok:#10b981;--err:#ef4444}

*{box-sizing:border-box}

html,body{height:100%}

body{margin:0;background:radial-gradient(1400px 700px at 50% -10%,#33415522,transparent),var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;display:flex;min-height:100%}

.container{max-width:980px;margin:auto;padding:24px;width:100%}

.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}

.badge{font-size:12px;color:#cbd5e1;border:1px solid #374151;padding:6px 10px;border-radius:999px;background:#0b1220}

.title{display:flex;flex-direction:column;align-items:center;margin:20px 0 24px}

.title h1{margin:0;font-size:40px;letter-spacing:.4px}

.title p{margin:10px 0 0;color:#cbd5e1}

.card{background:var(--panel);border:1px solid #1f2937;border-radius:14px;padding:18px;margin:14px 0;box-shadow:0 12px 30px #0006}

.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}

.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}

.label{font-size:12px;color:var(--muted);margin-bottom:6px}

input,button{font:inherit}

input{width:100%;padding:12px 14px;border:1px solid #374151;border-radius:10px;background:#0b1220;color:var(--text);outline:none}

button{padding:10px 14px;border-radius:10px;border:1px solid #2a3a6a;background:#101936;color:#cbd5e1;cursor:pointer}

button.primary{background:linear-gradient(180deg,#3b82f6,#2563eb);border-color:#2b50a8;color:white}

.row{display:flex;gap:10px;align-items:center}

.center{text-align:center}

.small{font-size:12px;color:#9ca3af}

.kv{display:grid;grid-template-columns:200px 1fr;gap:8px}

.ok{color:var(--ok)}.err{color:var(--err)}

/* light mode */

.light body{background:white;color:#0b1220}

.light .card{background:#ffffff;border-color:#e5e7eb;box-shadow:0 8px 22px #0001}

.light input{background:#f8fafc;border-color:#e5e7eb;color:#0b1220}

.light .badge{background:#eef2ff;color:#334155;border-color:#c7d2fe}

.toggle{display:inline-flex;gap:8px;align-items:center}

.toggle input{width:auto}

a.rocket{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:10px;border:1px solid #2a3a6a;background:#101936;text-decoration:none}

a.rocket svg{width:20px;height:20px;fill:#cbd5e1}

.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

</style>

</head>

<body>

<div class="container">



  <!-- Top bar -->

  <div class="topbar">

    <label class="toggle">

      <input id="modeToggle" type="checkbox" />

      <span>Light mode</span>

    </label>

    <span class="badge mono">GMODE Bv3</span>

    <a class="rocket" href="/admin" title="Admin">

      <svg viewBox="0 0 24 24"><path d="M12 2c3.5 0 6.5 2 8 5-3 .5-5.5 2.5-7 5-.5-1.5-1.5-3-3-3 .5-2 1-4 2-7zM6 14c1.5-1.5 3-2.5 4.5-3 .5 1.5 1.5 2.5 3 3-1 1.5-2.5 3-4 4.5-2-.5-3.5-1.5-3.5-4.5zM4 20c1.5 0 2.5-.5 3.5-1.5-.5 1.5-1.5 2.5-3.5 3.5-1-2-1-2-0-2z"/></svg>

    </a>

  </div>



  <!-- Title -->

  <div class="title">

    <h1>AXO</h1>

    <p>Sign‑up, Referral & XRP → AXO utility hub</p>

  </div>



  <!-- Steps -->

  <div class="card">

    <h3 class="center" style="margin:6px 0 14px">Quick Start</h3>

    <div class="grid">

      <div>

        <div class="label">1) Your XRPL wallet (r‑address)</div>

        <input id="wallet" placeholder="r................................" />

      </div>

      <div>

        <div class="label">Optional: Referrer wallet (r‑address)</div>

        <input id="ref" placeholder="r................................" />

      </div>

      <div class="row">

        <button id="btnPrepare" class="primary">Prepare Signup</button>

        <span id="prepMsg" class="small"></span>

      </div>

      <div class="row">

        <button id="btnClaim" class="">Claim 1000 AXO</button>

        <span id="claimMsg" class="small"></span>

      </div>

    </div>

  </div>



  <!-- Live Market -->

  <div class="card">

    <h3 style="margin:6px 0 14px">Live Market Data</h3>

    <div class="grid-3">

      <div>

        <div class="label">XRP Price (USD)</div>

        <div id="xrpPrice" class="mono">$—</div>

      </div>

      <div>

        <div class="label">AXO Price (USD, static)</div>

        <div id="axoPrice" class="mono">$0.01</div>

      </div>

      <div>

        <div class="label">1 XRP =</div>

        <div id="ratio" class="mono">— AXO</div>

      </div>

    </div>

    <div class="small" style="margin-top:10px">Source: <span id="marketSource">coingecko</span> · Updated <span id="marketTime">—</span></div>

  </div>



  <!-- Buy AXO (stub UI) -->

  <div class="card">

    <h3 style="margin:6px 0 14px">Buy AXO with XRP (optional)</h3>

    <div class="grid">

      <div>

        <div class="label">Your wallet (r‑address)</div>

        <input id="buyWallet" placeholder="r................................"/>

      </div>

      <div>

        <div class="label">Amount (XRP)</div>

        <input id="buyXrp" type="number" min="0" step="0.000001" placeholder="0.0"/>

      </div>

      <div class="row">

        <button id="btnQuote">Get Quote</button>

        <span id="buyMsg" class="small"></span>

      </div>

    </div>

  </div>



  <div class="center small" style="margin-top:8px;opacity:.8">© AXO</div>

</div>



<script>

// --- UI: light/dark toggle ---

const root = document.documentElement;

const modeToggle = document.getElementById('modeToggle');

(function initTheme(){

  const saved = localStorage.getItem('axo_theme') || 'dark';

  if(saved === 'light'){ document.documentElement.classList.add('light'); modeToggle.checked = true; }

})();

modeToggle.addEventListener('change', () => {

  if(modeToggle.checked){ document.documentElement.classList.add('light'); localStorage.setItem('axo_theme','light'); }

  else { document.documentElement.classList.remove('light'); localStorage.setItem('axo_theme','dark'); }

});



// --- Helper ---

const $ = (id) => document.getElementById(id);



// --- Live Market: poll every 30s ---

async function refreshMarket() {

  try {

    const r = await fetch('/api/market', { cache: 'no-store' });

    if (!r.ok) return;

    const j = await r.json();

    if ($('xrpPrice'))    $('xrpPrice').textContent     = j.xrp_usd ? `$${j.xrp_usd}` : '—';

    if ($('axoPrice'))    $('axoPrice').textContent     = j.axo_usd ? `$${j.axo_usd}` : '—';

    if ($('ratio'))       $('ratio').textContent        = j.axo_per_xrp ? `${Math.floor(j.axo_per_xrp)} AXO` : '—';

    if ($('marketSource'))$('marketSource').textContent = j.source || '';

    if ($('marketTime'))  $('marketTime').textContent   = new Date((j.ts||0)*1000).toLocaleTimeString();

  } catch(e) { /* ignore; try next tick */ }

}

refreshMarket();

setInterval(refreshMarket, 30_000);



// --- Signup flow (demo endpoints already in main.py) ---

$('btnPrepare').addEventListener('click', async () => {

  const address = ($('wallet').value||'').trim();

  const ref = ($('ref').value||'').trim();

  $('prepMsg').textContent = '...';

  try{

    const r = await fetch('/api/signup/prepare', {

      method:'POST',

      headers:{'Content-Type':'application/json'},

      body: JSON.stringify({address, ref})

    });

    const j = await r.json();

    $('prepMsg').textContent = r.ok ? 'Ready. Continue to Claim.' : (j.error || 'Error');

    $('prepMsg').className = 'small ' + (r.ok ? 'ok' : 'err');

  }catch(e){

    $('prepMsg').textContent = 'Network error'; $('prepMsg').className='small err';

  }

});



$('btnClaim').addEventListener('click', async () => {

  const address = ($('wallet').value||'').trim();

  const ref = ($('ref').value||'').trim();

  $('claimMsg').textContent = '...';

  try{

    const r = await fetch('/api/signup/claim', {

      method:'POST',

      headers:{'Content-Type':'application/json'},

      body: JSON.stringify({address, ref})

    });

    const j = await r.json();

    if(r.ok){

      $('claimMsg').textContent = `Claimed ${j.awarded_axo} AXO` + (j.ref_awarded_axo? ` · Referral +${j.ref_awarded_axo} AXO` : '');

      $('claimMsg').className='small ok';

    }else{

      $('claimMsg').textContent = j.error || 'Error'; $('claimMsg').className='small err';

    }

  }catch(e){

    $('claimMsg').textContent = 'Network error'; $('claimMsg').className='small err';

  }

});



// --- Buy quote (client-only preview; AXO price from /api/market) ---

$('btnQuote').addEventListener('click', async () => {

  $('buyMsg').textContent = '...';

  try{

    const r = await fetch('/api/market', { cache:'no-store' });

    const j = await r.json();

    const xrp = parseFloat(($('buyXrp').value||'0').trim());

    if(!j.xrp_usd || !j.axo_usd || !xrp || xrp<=0){

      $('buyMsg').textContent = 'Enter amount & wait for price...'; $('buyMsg').className='small err'; return;

    }

    // XRP USD value / AXO USD price = AXO received (client preview)

    const axo = (j.xrp_usd * xrp) / j.axo_usd;

    $('buyMsg').textContent = `~ ${Math.floor(axo)} AXO`; $('buyMsg').className='small ok';

  }catch(e){

    $('buyMsg').textContent = 'Price unavailable'; $('buyMsg').className='small err';

  }

});

</script>

</body>

</html>
